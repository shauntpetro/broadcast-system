<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sports Ticker - SEMEEX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: transparent;
      overflow: hidden;
    }

    .ticker-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0) 100%);
      padding: 20px 0 25px 0;
    }

    .ticker-bar {
      display: flex;
      align-items: center;
      padding: 0 30px;
      position: relative;
    }

    .ticker-underline {
      position: absolute;
      bottom: -8px;
      left: 30px;
      right: 30px;
      height: 2px;
      background: rgba(255,255,255,0.8);
    }

    .logo-container {
      flex-shrink: 0;
      margin-right: 12px;
    }

    .logo-container img {
      height: 45px;
      width: auto;
    }

    .brand-badge {
      background: linear-gradient(to bottom, #f5f5f5 0%, #e0e0e0 100%);
      color: #1a1a1a;
      font-weight: 800;
      font-size: 20px;
      padding: 8px 16px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .category-badge {
      background: linear-gradient(to bottom, #ffd700 0%, #e6c200 100%);
      color: #1a1a1a;
      font-weight: 800;
      font-size: 20px;
      padding: 8px 16px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .topic-label {
      color: #ffd700;
      font-weight: 700;
      font-size: 18px;
      margin-left: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .separator {
      color: rgba(255,255,255,0.5);
      font-size: 18px;
      margin: 0 12px;
    }

    .description {
      color: #ffffff;
      font-weight: 400;
      font-size: 18px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Animation for entrance */
    .ticker-container.hidden {
      transform: translateY(100%);
      opacity: 0;
    }

    .ticker-container {
      transition: transform 0.5s ease-out, opacity 0.5s ease-out;
    }

    /* Scrolling text animation */
    .scroll-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      align-items: center;
    }

    .scroll-text {
      display: inline-block;
      white-space: nowrap;
    }

    .scroll-text.animate {
      animation: scrollText var(--scroll-duration, 20s) linear infinite;
    }

    @keyframes scrollText {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Control panel styles */
    .control-panel {
      background: #1a1a1a;
      min-height: 100vh;
      padding: 20px;
      color: white;
    }

    .control-panel input, .control-panel textarea {
      background: #2a2a2a;
      border: 1px solid #444;
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      width: 100%;
      font-size: 14px;
    }

    .control-panel input:focus, .control-panel textarea:focus {
      outline: none;
      border-color: #ffd700;
    }

    .control-panel label {
      display: block;
      font-size: 12px;
      color: #888;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-panel button {
      background: #ffd700;
      color: #1a1a1a;
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .control-panel button:hover {
      background: #e6c200;
    }

    .control-panel button.secondary {
      background: #333;
      color: white;
    }

    .control-panel button.secondary:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const isOBSMode = urlParams.get('obs') === '1';

    // Default state
    let state = {
      show: true,
      logoUrl: '/public/logos/SemeexLogo.png',
      brand: 'SEMEEX',
      category: 'FOOTBALL',
      topic: 'TOPIC',
      description: 'Description of the news item goes here',
      scrollEnabled: false,
      scrollSpeed: 20
    };

    // WebSocket connection
    let ws = null;

    function connectWebSocket() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      const wsUrl = `${protocol}//${window.location.host}`;

      try {
        ws = new WebSocket(wsUrl);

        ws.onopen = () => {
          console.log('[Sports Ticker WS] Connected');
          if (isOBSMode) {
            ws.send(JSON.stringify({ type: 'sports_ticker_get' }));
          } else {
            // Sync state to server
            setTimeout(() => {
              ws.send(JSON.stringify({ type: 'sports_ticker_sync', ...state }));
            }, 500);
          }
        };

        ws.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            if (data.type === 'sports_ticker_update' || data.type === 'sports_ticker_init') {
              const tickerData = data.data || data;
              if (tickerData.brand !== undefined) state.brand = tickerData.brand;
              if (tickerData.category !== undefined) state.category = tickerData.category;
              if (tickerData.topic !== undefined) state.topic = tickerData.topic;
              if (tickerData.description !== undefined) state.description = tickerData.description;
              if (tickerData.logoUrl !== undefined) state.logoUrl = tickerData.logoUrl;
              if (tickerData.show !== undefined) state.show = tickerData.show;
              if (tickerData.scrollEnabled !== undefined) state.scrollEnabled = tickerData.scrollEnabled;
              if (tickerData.scrollSpeed !== undefined) state.scrollSpeed = tickerData.scrollSpeed;
              render();
            }
          } catch (e) {
            console.error('[Sports Ticker WS] Parse error:', e);
          }
        };

        ws.onclose = () => {
          console.log('[Sports Ticker WS] Disconnected, reconnecting...');
          setTimeout(connectWebSocket, 2000);
        };

        ws.onerror = (error) => {
          console.error('[Sports Ticker WS] Error:', error);
        };
      } catch (e) {
        console.error('[Sports Ticker WS] Failed to connect:', e);
      }
    }

    function broadcastState() {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({ type: 'sports_ticker_sync', ...state }));
      }
    }

    function renderOBS() {
      const app = document.getElementById('app');

      app.innerHTML = `
        <div class="ticker-container ${state.show ? '' : 'hidden'}">
          <div class="ticker-bar">
            ${state.logoUrl ? `
              <div class="logo-container">
                <img src="${state.logoUrl}" alt="Logo">
              </div>
            ` : ''}
            <div class="brand-badge">${state.brand}</div>
            <div class="category-badge">${state.category}</div>
            <span class="topic-label">${state.topic}</span>
            <span class="separator">|</span>
            <div class="scroll-container">
              <span class="description scroll-text ${state.scrollEnabled ? 'animate' : ''}" style="--scroll-duration: ${state.scrollSpeed}s">
                ${state.description}${state.scrollEnabled ? '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + state.description : ''}
              </span>
            </div>
            <div class="ticker-underline"></div>
          </div>
        </div>
      `;
    }

    function renderControlPanel() {
      const app = document.getElementById('app');

      app.innerHTML = `
        <div class="control-panel">
          <div class="max-w-4xl mx-auto">
            <h1 class="text-2xl font-bold mb-6 flex items-center gap-3">
              <span class="text-yellow-400">SPORTS</span> TICKER
            </h1>

            <!-- Preview -->
            <div class="bg-black rounded-xl overflow-hidden mb-8 relative" style="aspect-ratio: 16/9;">
              <div class="absolute bottom-0 left-0 right-0" style="background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 70%, rgba(0,0,0,0) 100%); padding: 15px 0 20px 0;">
                <div class="flex items-center px-5 relative">
                  ${state.logoUrl ? `<img src="${state.logoUrl}" class="h-8 mr-2" alt="Logo">` : ''}
                  <div style="background: linear-gradient(to bottom, #f5f5f5 0%, #e0e0e0 100%); color: #1a1a1a; font-weight: 800; font-size: 14px; padding: 5px 10px;">${state.brand}</div>
                  <div style="background: linear-gradient(to bottom, #ffd700 0%, #e6c200 100%); color: #1a1a1a; font-weight: 800; font-size: 14px; padding: 5px 10px;">${state.category}</div>
                  <span style="color: #ffd700; font-weight: 700; font-size: 13px; margin-left: 12px;">${state.topic}</span>
                  <span style="color: rgba(255,255,255,0.5); margin: 0 8px;">|</span>
                  <span style="color: white; font-size: 13px;">${state.description}</span>
                  <div style="position: absolute; bottom: -6px; left: 20px; right: 20px; height: 2px; background: rgba(255,255,255,0.8);"></div>
                </div>
              </div>
            </div>

            <!-- Controls -->
            <div class="grid grid-cols-2 gap-6 mb-6">
              <div>
                <label>Brand Name</label>
                <input type="text" id="brand" value="${state.brand}" placeholder="SEMEEX">
              </div>
              <div>
                <label>Category</label>
                <input type="text" id="category" value="${state.category}" placeholder="FOOTBALL">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-6 mb-6">
              <div>
                <label>Topic (Bold Yellow)</label>
                <input type="text" id="topic" value="${state.topic}" placeholder="BREAKING">
              </div>
              <div>
                <label>Logo URL (optional)</label>
                <input type="text" id="logoUrl" value="${state.logoUrl}" placeholder="https://...">
              </div>
            </div>

            <div class="mb-6">
              <label>Description</label>
              <input type="text" id="description" value="${state.description}" placeholder="Description of the news item goes here">
            </div>

            <div class="flex items-center gap-4 mb-6">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="scrollEnabled" ${state.scrollEnabled ? 'checked' : ''} class="w-5 h-5">
                <span class="text-sm">Enable text scrolling</span>
              </label>
              <div class="flex-1">
                <label>Scroll Speed: ${state.scrollSpeed}s</label>
                <input type="range" id="scrollSpeed" min="10" max="60" value="${state.scrollSpeed}" class="w-full">
              </div>
            </div>

            <div class="flex gap-4">
              <button onclick="toggleTicker()" class="${state.show ? 'secondary' : ''}">
                ${state.show ? 'Hide Ticker' : 'Show Ticker'}
              </button>
              <button onclick="openOBS()" class="secondary">
                Open OBS Output
              </button>
            </div>

            <div class="mt-8 p-4 bg-black/50 rounded-lg">
              <p class="text-sm text-gray-400">
                <strong class="text-white">OBS Browser Source URL:</strong><br>
                <code class="text-yellow-400">${window.location.origin}/ticker_sports.html?obs=1</code>
              </p>
              <p class="text-xs text-gray-500 mt-2">Recommended size: 1920x200</p>
            </div>
          </div>
        </div>
      `;

      // Attach event listeners
      document.getElementById('brand').addEventListener('input', (e) => {
        state.brand = e.target.value;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('category').addEventListener('input', (e) => {
        state.category = e.target.value;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('topic').addEventListener('input', (e) => {
        state.topic = e.target.value;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('description').addEventListener('input', (e) => {
        state.description = e.target.value;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('logoUrl').addEventListener('input', (e) => {
        state.logoUrl = e.target.value;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('scrollEnabled').addEventListener('change', (e) => {
        state.scrollEnabled = e.target.checked;
        broadcastState();
        renderControlPanel();
      });

      document.getElementById('scrollSpeed').addEventListener('input', (e) => {
        state.scrollSpeed = parseInt(e.target.value);
        broadcastState();
        renderControlPanel();
      });
    }

    function toggleTicker() {
      state.show = !state.show;
      broadcastState();
      render();
    }

    function openOBS() {
      window.open(window.location.origin + '/ticker_sports.html?obs=1', 'sports_ticker_obs', 'width=1920,height=200');
    }

    function render() {
      if (isOBSMode) {
        renderOBS();
      } else {
        renderControlPanel();
      }
    }

    // Initialize
    connectWebSocket();
    render();
  </script>
</body>
</html>
